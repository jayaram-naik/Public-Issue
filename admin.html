<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
</head>
<body class="bg-light">
  <div class="container py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h2>Admin Dashboard</h2>
      <div>
        <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('index') }}">Open Form</a>
        <a class="btn btn-sm btn-outline-danger" href="{{ url_for('admin_logout') }}">Logout</a>
      </div>
    </div>

    <table class="table table-striped table-sm">
      <thead>
        <tr>
          <th>ID</th><th>Type</th><th>Photo</th><th>Email</th><th>Location</th><th>Coords</th><th>Created</th><th>Status</th><th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for i in issues %}
        <tr>
          <td>{{ i.id }}</td>
          <td>{{ i.issue_type }}</td>
          <td>
            {% if i.image_path %}
              <a href="{{ url_for('uploaded_file', filename=i.image_path) }}" target="_blank">Photo</a>
            {% else %}-{% endif %}
          </td>
          <td>{{ i.email }}</td>
          <td style="max-width:200px">{{ i.location or '-' }}</td>
          <td>
            {% if i.latitude and i.longitude %}
              <a target="_blank" href="https://www.openstreetmap.org/?mlat={{ i.latitude }}&mlon={{ i.longitude }}#map=18/{{ i.latitude }}/{{ i.longitude }}">
                {{ '%.5f'|format(i.latitude) }}, {{ '%.5f'|format(i.longitude) }}
              </a>
            {% else %}-{% endif %}
          </td>
          <td>{{ i.created_at }}</td>
          <td>{{ i.status }}</td>
          <td>
            <form action="{{ url_for('admin_update', issue_id=i.id) }}" method="post" style="display:inline;">
              <select name="status" class="form-select form-select-sm" style="width:120px;display:inline-block;">
                <option value="open" {% if i.status=='open' %}selected{% endif %}>Open</option>
                <option value="in-progress" {% if i.status=='in-progress' %}selected{% endif %}>In-Progress</option>
                <option value="resolved" {% if i.status=='resolved' %}selected{% endif %}>Resolved</option>
              </select>
              <button class="btn btn-sm btn-primary" type="submit">Save</button>
            </form>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</body>
</html>
